<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>音声ナビゲーション</title>
</head>
<body>
  <h2>近くに来たら音声が再生されます</h2>
  <p id="status">位置情報を取得中...</p>
  <audio id="audio" src="Cheery_Melodies.mp3" preload="auto"></audio>

  <script>
    // 目標地点の緯度経度
    const targetLat = 35.69282342434481; // ←あなたの指定座標に変更
    const targetLng = 140.05081264777886;

    const radius = 10; // 半径10メートル
    let hasPlayed = false;

    // 距離計算（ハーサイン公式）
    function getDistanceFromLatLonInMeters(lat1, lon1, lat2, lon2) {
      const R = 6371000; // 地球半径 (m)
      const dLat = (lat2 - lat1) * Math.PI / 180;
      const dLon = (lon2 - lon1) * Math.PI / 180;
      const a =
        Math.sin(dLat/2) * Math.sin(dLat/2) +
        Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
        Math.sin(dLon/2) * Math.sin(dLon/2);
      const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
      return R * c;
    }

    function checkPosition(position) {
      const userLat = position.coords.latitude;
      const userLng = position.coords.longitude;

      const distance = getDistanceFromLatLonInMeters(userLat, userLng, targetLat, targetLng);

      document.getElementById("status").textContent =
        `現在地: ${userLat.toFixed(6)}, ${userLng.toFixed(6)}（距離: ${distance.toFixed(2)} m）`;

      if (distance < radius && !hasPlayed) {
        hasPlayed = true;
        document.getElementById("status").textContent += " → 近づきました！音声を再生します。";
        document.getElementById("audio").play();
      }
    }

    function error(err) {
      document.getElementById("status").textContent = "位置情報の取得に失敗しました: " + err.message;
    }

    // 位置情報の監視開始
    if (navigator.geolocation) {
      navigator.geolocation.watchPosition(checkPosition, error, {
        enableHighAccuracy: true,
        maximumAge: 1000,
        timeout: 10000
      });
    } else {
      document.getElementById("status").textContent = "このブラウザは位置情報に対応していません。";
    }
  </script>
</body>
</html>
